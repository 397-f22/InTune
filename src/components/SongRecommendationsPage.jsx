import { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { searchPlaylist, findSongs } from '../utilities/SpotifyConnect'
import SongRow from './SongRow';
import "./SongRecommendationsPage.css";
import { getSeason, timeOfDay } from '../utilities/location';

const SongRecommendationsPage = ({ weather, setWeather, autoGeneratedWeather, city }) => {
  const [playlist, setPlaylist] = useState([]);
  const [songs, setSongs] = useState([]);

  useEffect(() => {
    (async () => {
      const plays = await searchPlaylist(weather);
      setPlaylist(plays);

      const songdata = await findSongs(plays);
      setSongs(songdata);
    })();
  }, [])

  return (songs.length === 0)
    ? <div>Loading Songs…</div>
    : (
      <div>
        <Link to="/" params={{ weather, setWeather }}>
          <input
            className="regenerate-songs-button"
            type="button"
            value={autoGeneratedWeather ? "Reload" : "Go Home"}
          />
        </Link>
        <div className="user-metadata">
        {/* Change the statement to “recommended songs for a [weather] [season] [time of day] in [city]” (e.g. “Recommended songs for a cloudy fall afternoon in Evanston”; right now it just says “It’s a cloudy fall day in Evanston”) */}

          <h3>Recommended songs for a <b>{weather.toLowerCase()} {getSeason().toLowerCase()} {timeOfDay().toLowerCase()} {city !== "" ? `in ${city}` : ""}</b></h3>
        </div>
        <div className="playlist-link">
          <a target="_blank" href={playlist.external_urls.spotify}>View entire playlist</a>
        </div>

        <hr className="line-divide" />
        <div className="songs-list">
          {songs.map((song, id) => (
            <SongRow
              key={id}
              songTitle={song.name}
              imageUrl={song.album.images[0].url}
              spotifyUrl={song.external_urls.spotify}
            />
          ))}
        </div>
      </div>
    )
};

export default SongRecommendationsPage;
